steps:
##Build the docker image from the code using the docker file
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'build', '-t', 'us-east1-docker.pkg.dev/dev-environment-orgwebsite/digiarchs-docker-repo/hellodocker-image', '.' ]
  
## Run a sonarscan
- name: 'gcr.io/$PROJECT_ID/sonar-scanner:latest'
  args:
  - '-Dsonar.host.url=https://sonarcloud.io'
  - '-Dsonar.login=dockerweb'
  - '-Dsonar.projectKey=9d15c611dfe721b694b4472c188e218884da9ca0'
  - '-Dsonar.organization=digiarchs'
  - '-Dsonar.sources=.'
  tags: ['cloud-builders-community']

- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: ['run','deploy','first-service','--image', 
    'us-east1-docker.pkg.dev/dev-environment-orgwebsite/digiarchs-docker-repo/hellodocker-image', 
    '--region','us-central1','--platform','managed','--allow-unauthenticated','--timeout','300']
images: ['us-east1-docker.pkg.dev/dev-environment-orgwebsite/digiarchs-docker-repo/hellodocker-image']

